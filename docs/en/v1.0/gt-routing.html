<h1>Routing</h1>

<p class="alert alert-success">
	Full working example of routing and link generation is <a href="https://github.com/ondrej-nemec/TOTI/tree/master/src/test/java/samples/examples/routing">here</a>.
</p>

<h2>URI pattern</h2>

<p>
	TOTI use following information for routing:
	<ul>
		<li><code>Module::getName</code> method (<code>[module]</code>)</li>
		<li><code>Controller</code> annotation value (<code>[controller]</code>)</li>
		<li><code>Action</code> annotation value (<code>[method]</code>)</li>
		<li>Path: difference between <code>Module::getControllerPath</code> and controller package. Example below, (<code>[path]</code>)</li>
		<li><code>ParamUrl</code> annotation value (<code>[param]</code>)</li>
	</ul>
</p>

<strong>Path example</strong>

<p>
	Expect your controller path is <code>org/example/app/controllers</code>. <br>
	Path for <code>org.example.app.controllers.HomeController</code> is <code>""</code> (empty string) <br>
	Path for <code>org.example.app.controllers.api.ApiController</code> is <code>api</code> <br>
	Path for <code>org.example.app.controllers.top.secret.OnlyFoMyEyesController</code> is <code>top/secret</code>
</p>

<p>
	Final URI is builded from pattern. The pattern is in <a href="?file=doc-server.html">server configuration</a>. Default value is <code>/[module]&lt;/[path]&gt;/[controller]/[method]&lt;/[param]&gt;</code>.
</p>

<p>
	<code>&lt;/[...]&gt;</code> means variable is optional (can be empty string). <br>
	Is not nessessary to have all variables in pattern: <code>/[controller]/[method]&lt;/[param]&gt;</code>. <code>&lt;/[...]&gt;</code> <br>
	One action can has more <code>ParamUrl</code>. If you wish use it, expand pattern with more <code>&lt;/[param]&gt;</code>: <code>/[module]&lt;/[path]&gt;/[controller]/[method]&lt;/[param]&gt;&lt;/[param]&gt;</code>
</p>

<h2>Router</h2>

<p>
	In <code>Module::addRoutes</code> can be set some special routing.
</p>

<p class="alert alert-warning">
	Rememeber, there is only one insteance of <code>Router</code> for all modules. It means one module can override settings made in another module.
</p>

<h3>Redirect if user is not logged in</h3>

<p>
	If user try access on secured page, but is not logged in, the 401 UNAUTHORIZED is throwed. This can be overrided with <code>Router::setRedirectOnNotLoggedInUser</code>. If you set not null string, TOTI redirect on given URL and origin URL put to <code>backlink</code> URL parameter.
</p>

<strong>Example</strong>

<p>
	You set redirect on <code>/sign/in</code>. User try access on <code>/example/secured</code>. Is not logged in, so user is redirected to <code>/sign/in?backlink=/example/secured</code>.
</p>

<h3>Change URI</h3>

<p>
	<code>Router</code> allows change one URI to another. Usage: <code>router.addUrl(substitutionUri, originUri)</code>.
</p>

<strong>Example</strong>

<p>
	You have URI: <code>/users/log/in</code>. But you wish show login form on URI <code>/login</code>: <br>

	<code>router.addUrl("/login", "/users/log/in");</code> <br>
	From now, when somebody access <code>/login</code>, he get content of <code>/users/log/in</code>. The <code>/users/log/in</code> is still valid, working URI.
</p>

<p>
	Very common usage of this feature is for "home page" - set URI if origin URI is empty <code>router.addUrl("", "/core/home")</code>.
</p>

<p class="alert alert-warning">
	This is not redirect.
</p>

<h2>URI link generation</h2>

<p>
	To generate link via current pattern use <code>Link</code>. To get new instance, call factory method <code>Link.get()</code>.
</p>

<h3>From method calling</h3>

<p>
	Link can be generated by calling correct controller method. The code of method will not be executed.
</p>

<pre><code class="language-java">
Link.get().create(MyController.class, (controller)->controller.myAction());
</code></pre>

<p>
	If method contains parameter, let them be null or default value.
</p>

<pre><code class="language-java">
Link.get().create(MyController.class, (controller)->controller.myAction(null, 0, false));
</code></pre>

<p>
	Add all request parameters before creating.
</p>

<pre><code class="language-java">
Link.get()
	.addGetParam(name, value) // as many times as is required
	// AND
	.addUrlParam(value) // as many times as is required

	.create(MyController.class, (controller)->controller.myAction(null, 0, false));
</code></pre>

<h3>From configuration</h3>

<p>
	Link can be generated from given parameters:
</p>

<strong>Module</strong>
<p>If module is not set, actual module is used (works only if some controller is in calling stack trace).</p>
<pre><code class="language-java">
Link.get()
	.setModule(myModuleInstance)
	// OR
	.setModule(MyModule.class)
</code></pre>

<strong>Controller</strong>
<p>If controller is not set, actual controller is used (works only if some controller is in calling stack trace).</p>
<pre><code class="language-java">
Link.get()
	.setController(MyController.class)
	// OR
	.setController(stringRepresentationOfControllerClass)
</code></pre>

<strong>Method</strong>
<pre><code class="language-java">
Link.get().setMethod(methodNameInString)
</code></pre>

<strong>Add parameters</strong>
<pre><code class="language-java">
Link.get()
	.addGetParam(name, value)
	// OR
	.addUrlParam(value)
</code></pre>

<p>
	When parameters are set, call <code>Link::create()</code>.
</p>