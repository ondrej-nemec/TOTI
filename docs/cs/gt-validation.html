<h1>Validace požadavků</h1>

<p>
	Všechny parametry, které přijdou s požadavkem je nejlepší ověřit.
</p>

<p class="alert alert-success">
	Ukázky použití validace jsou v <a href="https://github.com/ondrej-nemec/TOTI/tree/dev/samples/examples">Examples</a> v části <i>validation</i>
</p>

<h2>Základní validace</h2>

<p>
	Pokud akce vyžaduje parametry jiného typu než <code>RequestParameters</code>, tyto parametry jsou velmi jednoduchým způsobem validovány. Například: Akce vyžaduje dva parametry - username (<code>String</code>) a věk(<code>int</code>). Prvním parametrem může být jakýkoli text. Ale druhý může být jen a pouze int. Pokud se vstupní hodnota nedá převést na int, vrátí se odpověď 500.
</p>

<pre><code>
@Action("noValidator")
public Response noValidator(@Param("username") String username, @Param("age") int age) {
	// ...
}
</code></pre>

<p class="alert alert-info">
	Třída s vyjmenovanými parametry funguje podobně.
</p>

<p class="alert alert-danger">
	Tento způsob nevaliduje celé <code>RequestParameters</code>.
</p>

<h2>Validator</h2>

<p>
	Pro přesnější validaci využijte třídu <code>Validator</code>. 
</p>

<h3>Konstruktor</h3>

<p>
	Validator can be created <code>new Validator(scrict)</code>. If <code>scrict</code> is true, validator will not accept request containings parameters that are not specified. Optionally use <code>new Validator(scrict, (translator, listOfNotSpecifiedParameters)->...)</code> constructor. This allow define error message. Default is <code>common.validation.not-expected-parameters</code> with parameter <code>params</code>
</p>

<p>
	Other way is <code>new Validator(itemRule)</code> (and <code>new Validator(itemRule, (translator, listOfNotMatchedParameters)->...)</code>). This constructor specify default <code>ItemRules</code> for not specified parameters. Usually used for validation of lists. Default message is <code>common.validation.parameters-not-match-default-rule</code> with parameter <code>params</code>.
</p>

<h3>ItemRules</h3>

<p>
	Rules for one item. <code>ItemRules</code> instance is created with factory methods. First one - <code>ItemRules.defaultRule()</code> - is used only if instance will be default rule. Second and third - <code>ItemRules.forName(name, required)</code> and <code>ItemRules.forName(name, required, (translator, paramName)->...)</code> - are for specific parameter.	<code>name</code> define parameter name, <code>required</code> says if parameter is required. The third parameter allows define error message. Default is <code>common.validation.item-required</code> and parameter is <code>param</code> (request parameter name).
</p>

<p>
	Add <code>ItemRules</code> to <code>Validator</code> with <code>addRule</code> method.
</p>

<strong>Example</strong>

<pre><code class="language-java">
new Validator(true)
	.addRule(
		ItemRules.forName("username", true)
			.setMinLength(3)
			.setMaxLength(15)
	)
	.addRule(
		ItemRules.forName("age", false)
			.setType(Integer.class)
			.setMinValue(0)
	);
</code></pre>

<p class="alert alert-info">
	List of all <code>ItemRules</code> options is <a href="?file=doc-validator.html">here</a>.
</p>

<h3>ParamsValidator and ParamValidator</h3>

<p>
	<code>Validator</code> contains method <code>setGlobalFunction</code>. This method allows works with parameters after validation but before calling action. Can be use fe. for comparing parameters.
</p>

<pre><code class="language-java">
new Validator(false)
	// ...
	.setGlobalFunction((requestParameters, validatorParameters, translator)->{
		Set&lt;String&gt; errors = ...;
		// ...
		return errors;
	});
</code></pre>

<p>
	The method <code>setGlobalFunction</code> always returns <code>Set</code>. Result cannot be null. If is empty, that means no errors.
</p>

<p>
	The method receive validated <code>RequestParameters requestParameters</code> as first parameter. The second is <code>RequestParamters validatorParameters</code> - empty structure. This or part of this can be used in action. It is accessible with <code>ParamsValidator</code> and <code>ParamValidator</code> annotations. The third is <code>Translator</code>.
</p>

<h3>Add validator to action</h3>

<p>
	The <code>Validator</code> can be added to action in two ways: as reference to <code>Register</code> and as method name.
</p>

<h4>Reference to Register</h4>

<p>
	Add the <code>Validator</code> instance to <code>Register</code> as service. Rememeber, key must be unique. Then add same key to <code>Action</code> annotation.
</p>
<strong>Add service</strong>
<pre><code class="language-java">
register.addService(VALIDATOR_SERVICE_KEY, validatorInstance);
</code></pre>

<strong>Action annotation</strong>
<pre><code class="language-java">
@Action(value = "--URL--", validator = VALIDATOR_SERVICE_KEY)
public Response myAction() {
	// ...
}
</code></pre>

<h4>Method name</h4>

<p>
	Create method inside your controller. Method can not hava parameters and must returns <code>Validator</code>. Then add method name to <code>Action</code> annotation.
</p>

<strong>Example</strong>

<pre><code class="language-java">
public Validator validatorMethod() {
	Validator validator = ...;

	return validator;
}

@Action(value = "--URL--", validator = "validatorMethod")
public Response myAction() {
	// ...
}

</code></pre>