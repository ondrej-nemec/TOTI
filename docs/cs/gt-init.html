<h1>Inicializace</h1>

<p class="introduction">
	TOTI lze spustit dvěma způsoby: jednoduše a vlastním způsobem. <strong>Jednoduché spuštění</strong> udělá hodně prázce za vás. Na druhou stranu, <strong>Vlastní spuštění</strong> je mnohem flexibilnější.
</p>

<h2>Jednoduché spuštění</h2>

<p>
	<strong>Jednoduché spuštění</strong> načte konfigurační soubor, automaticky vytvoří objekty <code>Database</code> (viz <a href="https://ondrej-nemec.github.io/JI/?file=database-db.html">JI Database</a>) a <code>Env</code> (see <a href="https://ondrej-nemec.github.io/JI/?file=common-functions.html">JI Common</a>) objects.
</p>

<p class="alert alert-info">
	Pokud konfigurace pro <code>Database</code> chybí, reference na <code>Database</code>  je NULL.
</p>

<p>
	Pro jednoduché potřebujete instanci třídy <code>Application</code>. Konstruktor vyžaduje seznam <code>Module</code> (více v dalších kapitolách).
</p>

<pre><code class="language-java">
Application application = new Application(Arrays.asList(
	// modules
));
</code></pre>

<p>
	<code>Application</code> se konfiguruje pomocí souburu <code>.properties</code>. Cesta k souboru se nastavuje pomocí  <code>Application.APP_CONFIG_FILE = ...</code>. Tento statický parametr musí být nastaven <strong>před</strong> konstruktorem. Výchozí hodnota je <code>conf/app.properties</code>. Soubor může být mezi souboury aplikace nebo i mimo. Seznam možné konfigurace je: <a href="?file=doc-server.html">Nastavení serveru</a>. Pokud nechcete použít konfigurační soubor a nechat vše ve výchozích hodnotách, nastavte <code>Application.APP_CONFIG_FILE = null;</code>
</p>

<h3>Ovládání</h3>

<p>
	<code>start</code> methoda provede:
	<ol>
		<li>Vytvoří a odmigruje databázi (pokud jsou databáze a migrace použity). <a href="https://ondrej-nemec.github.io/JI/?file=database-migrations.html">Více o migracích</a></li>
		<li>Spustí všechny úlohy z modulů (více v dalších kapitolách)</li>
		<li>Spustí HTTP server</li>
	</ol>
	Pokud <code>start</code> selže, není vyhozena žádná výjimka (jen je zalogovaná) a zavolá se <code>System.exit</code>.
</p>

<p>
	<code>stop</code> methoda dělá:
	<ol>
		<li>Zastaví HTTP server</li>
		<li>Zastaví všechny úlohy z modulů</li>
	</ol>
	Pokud <code>stop</code> selže, není vyhozena žádná výjimka (jen je zalogovaná) a zavolá se <code>System.exit</code>.
</p>

<p class="alert alert-warning">
	<code>Application</code> neháže výjimky. Vše je logováno.
</p>

<h2>Vlastní spuštění</h2>

<p>
	Nejprve potřebujete třídu <code>HttpServerFactory</code>. Tato třída drží konfiguraci pro <code>HttpServer</code>. Všechna konfigurace je dostupná <a href="?file=doc-server.html">zde</a>.
</p>

<p>
	Instace <code>HttpServer</code>u se získá pomocí metody <code>get</code>. Ta vyžaduje tři parametry: seznam modulů (více o modulech v dalších kapitolách) - seznam může být prázdný, ale nesmí být NULL; <code>Database</code> (viz <a href="https://ondrej-nemec.github.io/JI/?file=database-db.html">JI Database</a>) a <code>Env</code> (viz <a href="https://ondrej-nemec.github.io/JI/?file=common-functions.html">JI Common</a>). <code>Env</code> a <code>Database</code> mohou být null.
</p>


<pre><code class="language-java">
Database database = ...; // can be null
Env env = ...; // can be null
HttpServer server = new HttpServerFactory()
	// calling settings
	// ...
	.get(modules, env, database);
</code></pre>

<p>
	Metoda <code>start</code> provede:
	<ol>
		<li>Spustí všechny úlohy (viz další kapitoly)</li>
		<li>Spustí HTTP server</li>
	</ol>
</p>

<p>
	Metoda <code>stop</code> provede:
	<ol>
		<li>Zastaví HTTP server</li>
		<li>Zastaví všechny úlohy</li>
	</ol>
</p>

<h2>Příklad</h2>

<p class="alert alert-success">
	Oba způsoby spuštění jsou v <a href="https://github.com/ondrej-nemec/TOTI/tree/dev/samples/examples">Examples</a>, přímo ve spuštěcí třídě.
</p>

<p>
	Pokud chcete mít některé soubory dostupné ze prohlížeče (například HTML, CSS a JS), dejte do <code>www</code> složky přímo v kořenu aplikace.
</p>

<h5>Poznámka</h5>

<p>
	Jak <code>Application</code> tak <code>HttpServer</code> obsahují metodu <code>getTranslator</code> (<a href="https://ondrej-nemec.github.io/JI/?file=translate.html">JI Translator</a>) a <code>getRegister</code> (<code>Register</code>, více v dalších kapitolách).
</p>

<h2>Logování</h2>

<p>
	TOTI využívá <a href="https://logging.apache.org/log4j/2.x/">Log4j 2 API</a>. Ve výchozím nastavení TOTI používá jednoduchou konsolovou implementaci. Přiřazení vlastního loggeru:<br>

	<strong>Application</strong>
	<pre><code class="language-java">
	Application application = new Application(Arrays.asList(
		// modules
	), (loggerName)->{
		// TODO return logger
		// fe: return LogManager.getLogger(loggerName);
	});
	</code></pre>

	<strong>HttpServerFactory</strong>
	<pre><code class="language-java">
	Database database = ...; // can be null
	Env env = ...; // can be null
	HttpServer server = new HttpServerFactory()
		.setLoggerFactory((loggerName)->{
			// TODO return logger
			// fe: return LogManager.getLogger(loggerName);
		})
		// calling settings
		// ...
		.get(modules, env, database);
	</code></pre>

</p>

<p>
	TOTI využívá následující jména loggerů: <code>toti</code>, <code>translator</code>, <code>database</code> (jen při použití <code>Application</code>) a jeden logger pro každý modul s jeho jménem.
</p>