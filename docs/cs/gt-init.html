<h1>Inicializace</h1>

<p class="introduction">
	TOTI lze spustit dvěma způsoby: jednoduše a vlastním způsobem. <strong>Jednoduché spuštění</strong> udělá hodně prázce za vás. Na druhou stranu, <strong>Vlastní spuštění</strong> je mnohem flexibilnější.
</p>

<h2>Jednoduché spuštění</h2>

<p>
	<strong>Jednoduché spuštění</strong> načte konfigurační soubor, automaticky vytvoří objekty <code>Database</code> (viz <a href="https://ondrej-nemec.github.io/JI/?file=database-db.html">JI Database</a>) a <code>Env</code> (see <a href="https://ondrej-nemec.github.io/JI/?file=common-functions.html">JI Common</a>) objects.
</p>

<p class="alert alert-info">
	Pokud konfigurace pro <code>Database</code> chybí, reference na <code>Database</code>  je NULL.
</p>

<p>
	Nejprave potřebujete instanci třídy <code>Application</code>. Konstruktor vyžaduje seznam <code>Module</code> (více v dalších kapitolách).
</p>

<pre><code class="language-java">
Application application = new Application(Arrays.asList(
	// modules
));
</code></pre>

<p>
	<code>Application</code> se konfiguruje pomocí souburu <code>.properties</code>. Cesta k souboru se nastavuje pomocí  <code>Application.APP_CONFIG_FILE = ...</code>. Tento statický parametr musí být nastaven <strong>před</strong> konstruktorem. Výchozí hodnota je <code>conf/app.properties</code>. Soubor může být mezi souboury aplikace nebo i mimo. Seznam možné konfigurace je: <a href="?file=doc-server.html">Nastavení serveru</a>. Pokud nechcete použít konfigurační soubor a nechat vše ve výchozích hodnotách, nastavte <code>Application.APP_CONFIG_FILE = null;</code>
</p>

<h3>Ovládání</h3>

<p>
	<code>start</code> methoda provede:
	<ol>
		<li>Vytvoří a odmigruje databázi (pokud jsou databáze a migrace použity). <a href="https://ondrej-nemec.github.io/JI/?file=database-migrations.html">Více o migracích</a></li>
		<li>Spustí všechny úlohy z modulů (více v dalších kapitolách)</li>
		<li>Spustí HTTP server</li>
	</ol>
	Pokud <code>start</code> selže, není vyhozena žádná výjimka (jen je zalogovaná) a zavolá se <code>System.exit</code>.
</p>

<p>
	<code>stop</code> methoda dělá:
	<ol>
		<li>Zastaví HTTP server</li>
		<li>Zastaví všechny úlohy z modulů</li>
	</ol>
	Pokud <code>stop</code> selže, není vyhozena žádná výjimka (jen je zalogovaná) a zavolá se <code>System.exit</code>.
</p>

<p class="alert alert-warning">
	<code>Application</code> neháže výjimky. Vše je logováno.
</p>

<h2>Vlastní spuštění</h2>

<p>
	For custom init, let start with <code>HttpServerFactory</code>. This class holds configuration for <code>HttpServer</code>. The list of configurations is <a href="?file=doc-server.html">Server Configuration</a>.
</p>

<p>
	For creating <code>HttpServe</code> there are required two classes: <code>Database</code> (see <a href="https://ondrej-nemec.github.io/JI/?file=database-db.html">JI Database</a>) and <code>Env</code> (see <a href="https://ondrej-nemec.github.io/JI/?file=common-functions.html">JI Common</a>). Both can be null.
</p>


<pre><code class="language-java">
Database database = ...; // can be null
Env env = ...; // can be null
HttpServer server = new HttpServerFactory()
	// calling settings
	// ...
	.get(modules, env, database);
</code></pre>

<p>
	<code>start</code> method does:
	<ol>
		<li>Run all tasks from modules (see in next chapter)</li>
		<li>Start HTTP server</li>
	</ol>
</p>

<p>
	<code>stop</code> method does:
	<ol>
		<li>Stop HTTP server</li>
		<li>Stop all tasks from modules</li>
	</ol>
</p>

<h2>Examples</h2>

<p class="alert alert-success">
	<a href="https://github.com/ondrej-nemec/TOTI/tree/master/src/test/java/samples/examples/init" target=_blank>Here</a> can you find working samples. Running application can be checked <a href="http://localhost:8080/toti">http://localhost:8080/toti</a>.
</p>

<p>
	If you wish access some files from browser (typically css and js), place them in <code>www</code> folder in root of project.
</p>

<h5>Note</h5>

<p>
	Both <code>Application</code> and <code>HttpServer</code> contains methods <code>getTranslator</code> (<a href="https://ondrej-nemec.github.io/JI/?file=translate.html">JI Translator</a>) and <code>getRegister</code> (see in next chapter).
</p>

<h2>Logging</h2>

<p>
	TOTI uses <a href="https://logging.apache.org/log4j/2.x/">Log4j 2 API</a>. By default, TOTI contains simple console logger. For using your own: <br>

	<strong>Application</strong>
	<pre><code class="language-java">
	Application application = new Application(Arrays.asList(
		// modules
	), (loggerName)->{
		// TODO return logger
		// fe: return LogManager.getLogger(loggerName);
	});
	</code></pre>

	<strong>HttpServerFactory</strong>
	<pre><code class="language-java">
	Database database = ...; // can be null
	Env env = ...; // can be null
	HttpServer server = new HttpServerFactory()
		.setLoggerFactory((loggerName)->{
			// TODO return logger
			// fe: return LogManager.getLogger(loggerName);
		})
		// calling settings
		// ...
		.get(modules, env, database);
	</code></pre>

</p>

<p>
	There are names of logger required in TOTI: <code>toti</code>, <code>translator</code>, <code>database</code> (with using <code>Application</code> only) and name of each module.
</p>