<h1>Inicializace</h1>

<p class="introduction">
	TOTI lze nastavit jak programově, tak pomocí konfiguračního souboru. Případně lze obě metody zkombinovat. Priorita použití vlastností (od nejvyšší): programové nastavení, konfigurační soubor, výchozí hodnota.
</p>

<p>
	Pro spuštění TOTI je třeba nejprve vytvořit <code>HttpServerFactory</code>. V konstruktoru lze specifikovat cestu ke konfiguračnímu souboru. Tato třída také obsahuje konfigurační metody. Samotný <code>HttpServer</code> se vytvoří metodou <code>create</code>.
</p>

<p>
	<code>HttpServer</code> obsahuje metody <code>start</code> (spustí server) a <code>stop</code> (vypne server). Do <code>HttpServer</code> se přidávají jednotlivé aplikace <code>addApplication</code> a to i po spuštění serveru. Parametry této metody jsou: hostname (String) a callback, který vytvoří <code>Application</code>. Callback dostane instanci <code>Env</code> (vytovořenou za pomoci konfiguračního souboru z <code>HttpServerFactory</code>) a <code>ApplicationFactory</code> - funguje podobně jako <code>HttpServerFactory</code>. Výsledná <code>Application</code> se vytvoří <code>create</code>. Tato metoda vyžaduje list <code>Module</code> (více v dalších kapitolách).
</p>

<p>
	Metoda <code>addApplication</code> vrátí <code>Application</code>. Tato instance je <strong>automaticky</strong> přidána do TOTI. Tak je možné dostat se k vytvořeným instancím <code>Translator</code>, <code>Database</code>, <code>Link</code>, <code>Register</code> a seznamu migrací (<code>List&lt;String&gt;</code>);
</p>

<p class="alert alert-info">
	<code>ApplicationFactory</code> obsahuje také metodu <code>getTempPath</code>, která vrátí cestu k temp souborům aplikace.
</p>

<pre><code class="language-java">
	HttpServerFactory serverFactory = new HttpServerFactory(confFilePath);
	// do programaticall settings
	HttpServer server = serverFactory.create();
	server.addApplication(hostname, (env, factory)->{
		// set application programatically
		return factory.create(modules);
	});
</code></pre>


<p class="alert-info">
	Kompletní seznam konfigurace <a href="?file=doc-server.html">Nastavení serveru</a>.
</p>

<p class="alert alert-success">
	Oba způsoby nastavení jsou v <a href="https://github.com/ondrej-nemec/TOTI/tree/master/examples/samples">Examples</a>, přímo ve spuštěcí třídě.
</p>

<h2>Application</h2>

<p>
	<code>Application</code> také obsahuje metody <code>start</code> a <code>stop</code>. Pokud není nastaveni jinak, <code>Application</code> je puštěna současně s <code>HttpServer</code>, nebo po přidání do již běžícího serveru.
</p>

<p>
	<code>start</code> methoda provede:
	<ol>
		<li>Vytvoří a odmigruje databázi (pokud jsou databáze a migrace použity). <a href="https://ondrej-nemec.github.io/JI/?file=database-migrations.html">Více o migracích</a></li>
		<li>Spustí všechny úlohy z modulů (více v dalších kapitolách)</li>
	</ol>
</p>

<p>
	<code>stop</code> methoda dělá:
	<ol>
		<li>Zastaví všechny úlohy z modulů</li>
	</ol>
</p>


<h2>Logování</h2>

<p>
	TOTI využívá <a href="https://logging.apache.org/log4j/2.x/">Log4j 2 API</a>. Ve výchozím nastavení TOTI používá jednoduchou konsolovou implementaci. Přiřazení vlastního loggeru:<br>

	<pre><code class="language-java">
	serverFactory.setLoggerFactory((loggerName)->{
		// TODO return new logger
		// fe: return LogManager.getLogger(loggerName);
	});
	</code></pre>
</p>