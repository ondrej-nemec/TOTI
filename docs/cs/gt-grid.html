<h1>Grids</h1>

<p class="alert alert-success">
	Samples of grid are in <a href="https://github.com/ondrej-nemec/TOTI/tree/master/examples/samples">Examples</a> in part <i>grid</i>.
</p>

<p>
	TOTI provides JS library for displaying data in tables. The configuration for table/grid can be created with Java code and send to template, where will be displayed. Data are always laoded asynchronious.
</p>

<p class="alert alert-warning">
	For using TOTI JS grid library is nessessary to add <code>/toti/totiJs.js</code> to your page.
</p>

<p class="alert alert-warning">
	Text putted to configuration (column names, JS function names, titles, ... ) are NOT escaped to prevent XSS. <br>
	Data loaded to grid are in secured agains XSS.
</p>

<h2>Init and display</h2>

<p>
	The <code>Grid</code> constructor requires URL (as string) and HTTP method (get, post,... as string) for data loading.
</p>

<pre><code class="language-java">
Grid grid = new Grid("/load/data/url", "get");
</code></pre>

<h3>Settings</h3>

<p>
	Methods:
	<ul>
		<li>Page size: <code>setPageSize(size)</code> - how many items will be on page. Negative number means all items.</li>
		<li>Page size select: <code>setPagesSizes(listOfSizes)</code> and <code>setPagesSizes(listOfSizes, defautlSelectedSize)</code> - display select box with page sizes. If list of sizes is null, no paging used. Default is: [10, 20, 50, 100].</li>
		<li>Count of paging buttons <code>setPagesButtonCount(buttonsCount)</code>. Default is 5. Zero means no buttons.</li>
		<li>Loading button: <code>setUseLoadButton(use)</code> - if use loading button. Default false. Loading button add more items on page, but not remove previous.</li>
		<li>Row renderer: <code>setOnRowRenderer(rowRenderer)</code> - name of JS function. If specified, call custom JS function. To function are passed two parameters: row container and object of all values.</li>
		<li>Row selection: <code>useRowSelection(true|false)</code> - if use can select row. Selected row contains class 'row-selected'.</li>
		<li>Refresh interval: <code>setRefreshInterval(long refreshInterval)</code> - start refreshing data in given interval. 0 or less means no interval. Default is 0.</li>
		<li>Before render: <code>setBeforeRender(methodName)</code> - name of JS function called before grid is printed (with instance of JS class TotiGrid as parameter). Default is null and means no call.</li>
		<li>After render: <code>setAfterRender(methodName)</code> - name of JS function called after grid is printed(with instance of JS class TotiGrid as parameter). Default is null and means no call.</li>
		<li>Before bind: <code>setBeforeBind(methodName)</code> - name of JS function called (with binding values and instance of JS class TotiGrid as parameters) before data bind (called repeatedly with every data refresh). Default is null and means no call.</li>
		<li>After bind: <code>setAfterBind(methodName)</code> - name of JS function called (with binding values and instance of JS class TotiGrid as parameters) after data bind (called repeatedly with every data refresh). Default is null and means no call.</li>
	</ul>
</p>

<h3>Display</h3>

<p>
	Put <code>Grid</code> instance to template parameters.
</p>

<pre><code class="language-java">
Map<String, Object> params = new HashMap&lt;&gt;();
// ...
params.put("gridInstance", grid);
return Response.getTemplate("...", params);
</code></pre>

<p>
	In template, use unpaired <code>control</code> tag for print grid. Use variable name as control name.
</p>

<pre><code>
&lt;t:control name="gridInstance" /&gt;
</code></pre>

<p class="alert alert-info">
	You can get JS class instance of grid calling <code>${--variable-name--}</code> in JS.
</p>

<pre><code class="language-javascript">
var gridObject = ${gridInstance|noescape};
</code></pre>

<h2>Source data method</h2>

<p>
	Grid data request and response have specific format. For simplifing, there is <code>GridOptions</code> (for grid request) and <code>GridDataSet</code> (for response). You can always create data method without <code>GridOptions</code> and <code>GridDataSet</code>.
</p>

<h3>GridDataSet</h3>

<p>
	Structure for data. Holds list of rows (filtered and sorted), total row count and page index. <code>GridDataSet</code> implements Jsonable.
</p>

<h3>GridOptions</h3>

<p>
	<code>GridOptions</code> holds filters, sorting, page index and page size. Also contains static method for creating validator.
</p>

<strong>Raw - without GridOptions</strong>

<pre><code>
{
	"itemsCount": --number--,
	"pageIndex": --number--,
	"data" []
}
</code></pre>

<p>
	<code>data</code> is list of JSON objects, where property is name of column and value will be displayed.
</p>

<strong>Validator</strong>

<p>
	Validator for grid method is <code>GridOptions.getValidator</code>. Requires List of <code>GridColumn</code>. <code>GridColumn</code> requires column name. The value class can be speficified, too.
</p>

<p>
	Methods:
	<ul>
		<li>Constructor 1: <code>new GridColumn(name)</code> - column with only name specified</li>
		<li>Constructor 2: <code>new GridColumn(name, clazz)</code> - column with name and type</li>
		<li>Use in sorting: <code>setUseInSorting(true|false)</code> - if rule will be used for sorting, default: true</li>
		<li>Use in filtering: <code>setUseInFilter(true|false)</code> - if rule will be used for filtering, default: true</li>
		<li>Filtering mode: <code>setFilterMode(LIKE|EQUALS|STARTS_WITH|ENDS_WITH)</code> - default: EQUALS</li>
		<li>Change sorting name: <code>setSortingName(newName)</code> - usualy used if you wish one column sort by id and filter by name.</li>
	</ul>
</p>

<strong>Example</strong>

<pre><code class="language-java">
@Action(value = "url", validator = "exampleMethodValidator")
public Response exampleDataMethod(@Params GridOptions options) {
	// return data using GridDataSet or JSON
}

public Validator exampleMethodValidator() {
	return GridOptions.getValidator(Arrays.asList(
		new GridColumn("one"), // only column name specified
		new GridColumn("two", Double.class), // column name and value type
		new GridColumn("three").setUseInSorting(false), // use only for filter
		new GridColumn("four").setUseInFilter(false), // use only fo sorting
		new GridColumn("five").setUseInFilterFilterMode.LIKE), // set sorting mode
		new GridColumn("six").setSortingName("seven") // change column name for sorting
	));
}
</code></pre>
<!--
<strong>Raw</strong>

<pre><code class="language-java">
new Validator(true)
	.addRule(ItemRules.forName("pageIndex", true))
	.addRule(ItemRules.forName("pageSize", true))
	.addRule(ItemRules.forName("filters", true).setMapSpecification(new Validator(true)
		// add one rule for each column, name is required, type is optional
		.addRule(ItemRules.forName(--column-name--, false).setType(String.class))
	))
	.addRule(ItemRules.forName("sorting", true).setMapSpecification(new Validator(true)
		// add one rule for each column, name and allowed values are required
		.addRule(ItemRules.forName("name", false).setAllowedValues(Arrays.asList("ASC", "DESC")))
	));
</code></pre>
-->
<h2>Grid columns</h2>

<p>
	Into <code>Grid</code> can be added three types of column: <code>ValueColumn</code>, <code>ButtonColumn</code> and <code>ActionColumn</code>.
</p>

<h3>ValueColumn</h3>

<p>
	<code>ValueColumn</code> will display value. The value will be displayed as except: column has renderer (see bellow), column has select filter (TOTI try find the value in select's options and display it. If no founded, the value will be displayed) and column has some of date and time filters (date or time is parsed with local format).
</p>

<p>
	Methods:
	<ul>
		<li>Constructor: <code>new ValueColumn(name)</code></li>
		<li>Set column title: <code>setTitle(title)</code>. Default: same as name.</li>
		<li>Allow sorting: <code>setUseSorting(true|false)</code>. Only for GUI, has no effect on data method. Default: false.</li>
		<li>Set filter: <code>setFilter(filter)</code>. Add filter input. List of all filters is <a href="?file=doc-inputs.html">here</a>.</li>
		<li>JS value renderer: <code>setRenderer</code>. Name of JS function. TOTI send two parametes into method: value (as first) and all values from given row (as second)</li>
	</ul>
</p>

<h3>ButtonsColumn</h3>

<p>
	<code>ButtonsColumn</code> holds list of buttons. Also can contains reset button for filters.
</p>

<p>
	Methods:
	<ul>
		<li>Constructor: <code>new ButtonsColumn(name)</code></li>
		<li>Set title: <code>setTitle(title)</code> - title of column, default is same as name</li>
		<li>Reset filter button: <code>setResetFiltersButton(button)</code> - show button as reset button with reset func.</li>
		<li>Buttons: <code>addButton(button)</code> - add button to list, can be called more times.</li>
		<li>Global button: <code>addGlobalButton(button)</code> - add button to filter part of column. Usualy Add button.</li>
	</ul>
</p>

<p>
	<strong>Can be used moretimes, but remember to have unique name.</strong>
</p>

<h3>ActionsColumn</h3>

<p>
	<code>ActionsColumn</code> contains only checkboxex. This is for Group actions.
</p>

<p>
	Methods:
	<ul>
		<li>Constructor: <code>new ActionsColumn(name)</code></li>
		<li>Set title: <code>setTitle(title)</code> - title of column, default is same as name</li>
		<li>Row unique: <code>setUniqueRowIdentifier(unique)</code> - unique from row values. This value will be sended to Action method. Default is 'id'.</li>
	</ul>
</p>

<p>
	<strong>Can be used moretimes, but remember to have unique name.</strong>
</p>

<h3>TreeColumn</h3>

<p>
	Umožňuje zobrazit řádky ve stromové struktuře. Řádky je lze zobrazit/skrýt. Potomci řádku jsou vždy řazeny pod rodičovský řádek. <code>Grid</code> může mít pouze jeden <code>TreeColumn</code>.
</p>

<p>
	Metody:
	<ul>
		<li>Konstruktor: <code>new TreeColumn(idName, parentName)</code></li>
		<li>Nastavení titulku: <code>setTitle(title)</code> - titulek sloupce s řídícími prvky. Ve výchozím nastavení je prázdný.</li>
		<li>Level rozbalení: <code>setExpandLevel(level)</code> - úroveň rozbalení řádků, kdy řádek bez rodiče je level 0. Potomci budou ve výchozím nastavení skryti, pokud jejich úroveň je rovna nebo větší danému levelu. Výchozí hodnota je 2.</li>
	</ul>
</p>

<h2>Group actions</h2>

<p>
	<code>GroupAction</code> allows execute some code for more rows at once. Requires at least one <code>ActionsColumn</code>. Add <code>GroupAction</code> to <code>Grid</code> calling <code>addAction(action)</code> (can be called more times).
</p>

<p>
	Methods:
	<ul>
		<li>Constructor: <code>new GroupAction(title, link)</code></li>
		<li>Confirmation: <code>setConfirmatio(textOfConfirmaion)</code> - if specified, TOTI display confirmation before executing.</li>
		<li>Async/sync sending: <code>setAsync(true|false)</code> - send request async or not. Defautl is true.</li>
		<li>Request method: <code>setMethod(method)</code> - Default is "get".</li>
		<li>On success: <code>setOnSuccess(methodName)</code> - name of JS function called on success.</li>
		<li>On failure: <code>setOnFailure(methodName)</code> - name of JS function called on failure.</li>
	</ul>
</p>


<h2>Custom display</h2>

<p>
	Custom display allow change HTML inside grid. In template, use paired <code>control</code> tag for print grid. Use variable name as control name.
</p>

<p>
	Custom HTML has to contains and can contains elements for controlling render: TOTI tag <code>grid</code> and elements with special attributes.
</p>

<h3>Grid caption</h3>

<strong>Optional</strong>

<p>Element with <code>toti-grid="caption"</code> attribute.</p>

<strong>Example</strong>

<pre><code class="language-html">
&lt;div toti-grid="caption"&gt;&lt;/div&gt;
</code></pre>

<h3>Pagging buttons</h3>

<strong>Optional</strong>

<p>Where the pagging buttons will be. Element with <code>toti-grid="page-buttons"</code> attribute.</p>

<strong>Example</strong>

<pre><code class="language-html">
&lt;div toti-grid="page-buttons"&gt;&lt;/&gt;
</code></pre>

<h4>Button template</h4>

<p>Pagging button required child element template. Template contains one button. Place for button text is element with <code>toti-grid-page-button="title"</code> attribute.</p>

<p>
	Template is required, title element is optional.
</p>

<strong>Example</strong>

<pre><code class="language-html">
&lt;div toti-grid="page-buttons"&gt;
	&lt;template&gt;
		&lt;button toti-grid-page-button="title"&gt;&lt;/button&gt;
	&lt;/template&gt;
&lt;/div&gt;
</code></pre>

<h3>Page size</h3>

<strong>Optional</strong>

<p>Select with <code>toti-grid="page-size"</code> attribute. Options are available page sizes.</p>

<strong>Example</strong>

<pre><code class="language-html">
&lt;select toti-grid="page-size"&gt;&lt;/select&gt;
</code></pre>

<h3>Selected row background color</h3>

<strong>Optional</strong>

<p>
	You can set selected row background color by adding <code>toti-selected-row-color</code> parameter to <code>control</code> tag. Value of parameter is CSS color definition (<code>red</code>, <code>#12F4DA</code>).
</p>

<h3>Column title</h3>

<strong>Optional</strong>

<p>Element with <code>toti-grid-title</code> attribute. Value is name of column</p>

<strong>Example</strong>

<pre><code class="language-html">
&lt;div toti-grid-title="username"&gt;&lt;/div&gt;
</code></pre>

<h3>Sorting</h3>

<strong>Optional</strong>

<p>Element with <code>toti-grid-sort</code> attribute. Value is name of JS function. Input parameters are: source element, sort order (null: no sort, false: asc, true: desc).</p>
<p>Also <code>name</code> parameter is required. Value is column name.</p>

<strong>Example</strong>

<pre><code class="language-html">
&lt;div toti-grid-sort="changeSortMark" name="username"&gt;&lt;/div&gt;
</code></pre>

<strong>And later (or early)</strong>
<pre><code class="language-html">
&lt;script&gt;
function changeSortMark(srcElement, sortOrder) {
	// fe. change sorting icons
}
&lt;/script&gt;
</code></pre>

<h3>Place for rows</h3>

<strong>Required</strong>

<p>Place where rows will be rendered. Element with <code>toti-grid="rows"</code> attribute.</p>

<strong>Example</strong>

<pre><code class="language-html">
&lt;div toti-grid="rows" &gt;&lt;/div&gt;
</code></pre>

<h4>Row template</h4>

<p>
	Row template is required. The template is child of rows place element. Can contains elements with <code>toti-grid-cell</code> where value is column name. The elements are placeholders for row values. Placeholder for row buttons is also with attribute <code>toti-grid-cell</code>.
</p>

<strong>Example</strong>

<pre><code class="language-html">
&lt;div toti-grid="rows"&gt;
	&lt;template&gt;
		&lt;div toti-grid-cell="username"&gt;&lt;/div&gt;
	&lt;/template&gt;
&lt;/div&gt;
</code></pre>

<h3>Filter</h3>

<strong>Optional</strong>

<p>
	TOTI <code>grid</code> tag with <code>filter</code> attribute where value is column name. All other attributes will be give to final HTML element.
</p>

<strong>Example</strong>

<pre><code class="language-html">
&lt;grid filter="username" /&gt;
</code></pre>

<h3>Global buttons</h3>

<strong>Optional</strong>

<p>
	TOTI <code>grid</code> tag with <code>buttons</code> attribute where value is column name. All other attributes will be give to final HTML element.
</p>

<strong>Example</strong>

<pre><code class="language-html">
&lt;grid buttons="username" /&gt;
</code></pre>

<h3>Checkbox</h3>

<strong>Optional</strong>

<p>
	TOTI <code>grid</code> tag with <code>checkbox</code> attribute where value is column name. All other attributes will be give to final HTML element. For main checkbox in filters and also for row checkbox.
</p>

<strong>Example</strong>

<pre><code class="language-html">
&lt;grid checkbox="username" /&gt;
</code></pre>